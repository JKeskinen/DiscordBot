!function(e){function n(a){if(t[a])return t[a].exports;var s=t[a]={exports:{},id:a,loaded:!1};return e[a].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}var t={};n.m=e,n.c=t,n.p="",n(0)}([function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var a,s,o,i=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},r=(s=a=function e(n,a,s){t(this,e),o.call(this),this.uploadUrl=a,this.labels=i({reset:"Reset",remove:"Remove",upload:"Upload",save:"Save"},s),this.$pic=$(n),this.createCrontrol(n),this.createSpinner(n),this.savedBg=this.$pic.css("background-image"),this.isUnsaved=!1,this.saving=!1,window.addEventListener("beforeunload",this.warnAboutUnsaved)},o=function(){var e=this;this.createCrontrol=function(n){var t=n.split(" ").pop().replace(/^[#\.]/,"").replace(/[\[\]=">\+~\*\^]+$/g,"").replace(/[\[\]=">\+~\*\^]+/g,"-");e.$control=$("<div>").addClass("change-"+t).prependTo(e.$pic),e.$input=$("<input>").attr("type","file").change(e.onFileSelected).appendTo(e.$control);$("<div>").addClass("button-group").appendTo(e.$control).append(Object.keys(e.labels).map(function(n){var t=$("<button>").text(e.labels[n]).addClass("button "+n),a="on"+(n[0].toUpperCase()+n.slice(1));return a in e&&t.click(e[a]),t}))},this.createSpinner=function(n){e.$spinner=$("<div>").addClass("profile-pic-spinner").prependTo(e.$pic)},this.onUpload=function(n){n.preventDefault(),e.$input.trigger("click")},this.onFileSelected=function(n){if(n.target.files.length){var t=n.target.files[0],a=new FileReader;a.onload=e.onFileLoaded,a.readAsDataURL(t)}},this.onFileLoaded=function(n){e.setUnsaved(),e.$pic.css("background-image","url("+n.target.result+")").removeClass("no-pic")},this.onSave=function(n){n.preventDefault(),e.saving=!0;var t=new XMLHttpRequest,a=new FormData;e.$pic.addClass("saving"),a.append("profilePic",e.$input[0].files.length?e.$input[0].files[0]:"none"),t.upload.addEventListener("error",function(){return e.$pic.removeClass("saving")}),t.upload.addEventListener("abort",function(){return e.$pic.removeClass("saving")}),t.upload.addEventListener("load",e.onUploaded),t.open("POST",e.uploadUrl),/localhost|bitbucket/.test(location.hostname)?setTimeout(e.onUploaded,2e3):t.send(a)},this.onUploaded=function(n){e.$pic.removeClass("saving"),e.savedBg=e.$pic.css("background-image"),e.isUnsaved=!1,e.$control.removeClass("unsaved")},this.onRemove=function(n){n.preventDefault(),e.setUnsaved(),e.$pic.css("background-image","").addClass("no-pic")},this.onReset=function(n){n.preventDefault(),e.isUnsaved=!1,e.$input.val(""),e.$control.removeClass("unsaved"),e.$pic.css("background-image",e.savedBg).toggleClass("no-pic","none"==e.savedBg)},this.setUnsaved=function(){e.isUnsaved=!0,e.$control.addClass("unsaved")},this.warnAboutUnsaved=function(n){if(e.isUnsaved&&!e.saving){return(n||window.event).returnValue="You have unsaved changes!","You have unsaved changes!"}}},s);window.MetrixProfilePic=r}]);